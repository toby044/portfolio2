import{aq as D,r as v,I as O,o as ee,L as y,X as ae,d as re,e as te,au as oe,Q as h,f as F,av as ie,h as W,B as G,aa as ne,a5 as w,J as I,ab as se,aw as le,g as ce}from"./BKieBgHS.js";import{h as $}from"./lXAzfyap.js";import{u as ue,o as pe,a as P,s as M,d as ge,l as j,e as de,c as me}from"./DAGpHY9b.js";import{u as fe}from"./CU2ONPTF.js";import ve from"./B0yWURJp.js";import"./DcTIxxWD.js";import"./CaibcaqA.js";pe({apiKey:M(),libraries:P(de(M())),language:P(M()),region:P(M()),v:P(ge([j("weekly"),j("quarterly"),j("beta"),j("alpha"),M()]))});function ye(A){let b=Promise.resolve();return ue("googleMaps",n=>{const t=(n==null?void 0:n.libraries)||["places"],k=n!=null&&n.language?{language:n.language}:void 0,L=n!=null&&n.region?{region:n.region}:void 0,u=n!=null&&n.v?{v:n.v}:void 0;return{scriptInput:{src:D("https://maps.googleapis.com/maps/api/js",{libraries:t.join(","),key:n==null?void 0:n.apiKey,loading:"async",callback:"google.maps.__ib__",...k,...L,...u})},clientInit:()=>{window.google=window.google||{},window.google.maps=window.google.maps||{},b=new Promise(S=>{window.google.maps.__ib__=S})},schema:void 0,scriptOptions:{use(){return{maps:b.then(()=>window.google.maps)}}}}},A)}const $e={__name:"ScriptGoogleMaps",props:{trigger:{type:[String,Array,Boolean],required:!1,default:["mouseenter","mouseover","mousedown"]},aboveTheFold:{type:Boolean,required:!1},apiKey:{type:String,required:!1},center:{type:null,required:!1},centerMarker:{type:Boolean,required:!1,default:!0},mapOptions:{type:null,required:!1},region:{type:String,required:!1},language:{type:String,required:!1},version:{type:String,required:!1},width:{type:[Number,String],required:!1,default:640},height:{type:[Number,String],required:!1,default:400},placeholderOptions:{type:Object,required:!1},placeholderAttrs:{type:Object,required:!1},rootAttrs:{type:Object,required:!1},markers:{type:Array,required:!1}},emits:["ready","error"],setup(A,{expose:b,emit:n}){var H;const t=A,k=n,L=t.apiKey||((H=me("googleMaps"))==null?void 0:H.apiKey),u=v(),S=v(),B=v(),q=v(),E=fe({trigger:t.trigger,el:S}),{load:J,status:d,onLoaded:U}=ye({apiKey:t.apiKey,scriptOptions:{trigger:E},region:t.region,language:t.language,v:t.version}),p=O(()=>{var e;return w({center:q.value},t.mapOptions,{center:t.center,zoom:15,mapId:(e=t.mapOptions)!=null&&e.styles?void 0:"map"})}),m=v(!1),s=v(),c=v(new Map);function K(e){return typeof e=="string"&&(e.split(",").length>2||e.includes("+"))}function T(e){return new Promise(async a=>{const r=e instanceof Promise?await e:e;r&&r.setMap(null),a()})}function R(e){const a=typeof e=="string"?{position:{lat:Number.parseFloat(e.split(",")[0]||"0"),lng:Number.parseFloat(e.split(",")[1]||"0")}}:e;return a.position||(a.position={lat:0,lng:0}),a}async function z(e){if(!e)return;const a=R(e),r=$({position:a.position});if(c.value.has(r))return c.value.get(r);const o=new Promise(async i=>{const l=await Q("marker"),g=w(I(a),{map:I(s.value),position:a.location});i(new l.AdvancedMarkerElement(g))});return c.value.set(r,o),o}const N=new Map;async function C(e){return e&&typeof e=="object"?Promise.resolve(e):N.has(e)?Promise.resolve(N.get(e)):new Promise(async(a,r)=>{u.value||(await J(),await new Promise(i=>{const l=y(u,()=>{l(),i()})})),new u.value.places.PlacesService(s.value).findPlaceFromQuery({query:e,fields:["name","geometry"]},(i,l)=>{var g,f;return l==="OK"&&((f=(g=i==null?void 0:i[0])==null?void 0:g.geometry)!=null&&f.location)?a(i[0].geometry.location):r(new Error(`No location found for ${e}`))})}).then(a=>(N.set(e,a),a))}const _=new Map;function Q(e){var r;if(_.has(e))return _.get(e);const a=((r=u.value)==null?void 0:r.importLibrary(e))||new Promise(o=>{const i=y(u,l=>{if(l){const g=l.importLibrary(e);o(g),i()}},{immediate:!0})});return _.set(e,a),a}const x={googleMaps:u,map:s,createAdvancedMapMarker:z,resolveQueryToLatLang:C,importLibrary:Q};b(x),ee(()=>{y(m,e=>{e&&k("ready",x)}),y(d,e=>{e==="error"&&k("error")}),y(p,()=>{var e;(e=s.value)==null||e.setOptions(p.value)}),y([()=>t.markers,s],async()=>{if(!s.value)return;const e=new Map((t.markers||[]).map(i=>[$({position:R(i).position}),i])),a=new Set([...c.value.keys()].filter(i=>!e.has(i))),r=new Set([...e.keys()].filter(i=>!c.value.has(i))),o=$({position:p.value.center});for(const i of a){if(t.centerMarker&&i===o)continue;const l=await c.value.get(i);l&&T(l).then(()=>{c.value.delete(i)})}for(const i of r)z(e.get(i))},{immediate:!0,deep:!0}),y([()=>p.value.center,m,s],async(e,a)=>{if(!s.value)return;let r=I(e[0]);if(r&&(K(r)&&m.value&&(r=await C(r)),s.value.setCenter(r),t.centerMarker)){if(p.value.mapId)return;if(a[0]){const o=$({position:a[0]});c.value.has(o)&&T(c.value.get(o)).then(()=>{c.value.delete(o)})}z({position:r})}},{immediate:!0}),U(async e=>{var o;u.value=await e.maps;const a=p.value.center,r={...p.value,center:!a||K(a)?void 0:a};s.value=new u.value.Map(B.value,r),a&&K(a)&&(q.value=await C(a),(o=s.value)==null||o.setCenter(q.value)),m.value=!0})});function X(e){return e.map(a=>{const r=a.featureType?`feature:${a.featureType}`:"",o=a.elementType?`element:${a.elementType}`:"",i=(a.stylers||[]).map(l=>Object.entries(l).map(([g,f])=>(g==="color"&&typeof f=="string"&&(f=f.replace("#","0x")),`${g}:${f}`)).join("|")).filter(Boolean).join("|");return[r,o,i].filter(Boolean).join("|")}).filter(Boolean)}const V=O(()=>{var r;let e=p.value.center;e&&typeof e=="object"&&(e=`${e.lat},${e.lng}`);const a=w(t.placeholderOptions,{zoom:p.value.zoom,center:e},{size:`${t.width}x${t.height}`,key:L,scale:2,style:(r=t.mapOptions)!=null&&r.styles?X(t.mapOptions.styles):void 0,markers:[...t.markers||[],t.centerMarker&&e].filter(Boolean).map(o=>(typeof o=="object"&&o.location&&(o=o.location),typeof o=="object"&&o.lat?`${o.lat},${o.lng}`:o)).join("|")});return D("https://maps.googleapis.com/maps/api/staticmap",a)}),Y=O(()=>w(t.placeholderAttrs,{src:V.value,alt:"Google Maps Static Map",loading:t.aboveTheFold?"eager":"lazy",style:{cursor:"pointer",width:"100%",objectFit:"cover",height:"100%"}})),Z=O(()=>w(t.rootAttrs,{"aria-busy":d.value==="loading","aria-label":d.value==="awaitingLoad"?"Google Maps Static Map":d.value==="loading"?"Google Maps Map Embed Loading":"Google Maps Embed","aria-live":"polite",role:"application",style:{cursor:"pointer",position:"relative",maxWidth:"100%",width:`${t.width}px`,height:"'auto'",aspectRatio:`${t.width}/${t.height}`},...E instanceof Promise?E.ssrAttrs||{}:{}}));return ae(async()=>{var e,a,r;await Promise.all([...c.value.entries()].map(([,o])=>T(o))),c.value.clear(),(e=s.value)==null||e.unbindAll(),s.value=void 0,(r=(a=B.value)==null?void 0:a.firstChild)==null||r.remove()}),(e,a)=>(te(),re("div",ne({ref_key:"rootEl",ref:S},Z.value),[oe(W("div",{ref_key:"mapEl",ref:B,style:{width:"100%",height:"100%",maxWidth:"100%"}},null,512),[[ie,m.value]]),m.value?F("",!0):h(e.$slots,"placeholder",{key:0,placeholder:V.value},()=>[W("img",se(le(Y.value)),null,16)]),G(d)!=="awaitingLoad"&&!m.value?h(e.$slots,"loading",{key:1},()=>[ce(ve)]):F("",!0),G(d)==="awaitingLoad"?h(e.$slots,"awaitingLoad",{key:2}):G(d)==="error"?h(e.$slots,"error",{key:3}):F("",!0),h(e.$slots,"default")],16))}};export{$e as default};
